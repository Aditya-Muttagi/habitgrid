name: Reset Habits Daily (IST midnight)

on:
  schedule:
    - cron: "30 18 * * *"   # runs daily at 00:00 IST (18:30 UTC)
  workflow_dispatch:

jobs:
  reset:
    runs-on: ubuntu-latest
    steps:
      - name: Install psql client
        run: sudo apt-get update && sudo apt-get install -y postgresql-client

      - name: Run SQL to reset habits
        env:
          DATABASE_URL: ${{postgresql+asyncpg://neondb_owner:npg_OJtU71icGaAg@ep-jolly-truth-a1pr7crh-pooler.ap-southeast-1.aws.neon.tech/neondb }}
        run: |
          set -e
          echo "Running UPDATE habit_entries SET done = FALSE;"
          psql "$DATABASE_URL" <<'EOF'
          UPDATE habit_entries SET done = FALSE;
          EOF
